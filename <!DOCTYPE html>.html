<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>漢字当てゲーム</title>
    <style>
        /* スタイルは省略 */
    </style>
</head>
<body>
    <div id="start-container">
        <h1>漢字当てゲーム</h1>
        <p>漢字の読みを当てるゲームです。送り仮名はいりません。</p>
        <div id="level-selection">
            <button onclick="startGame(1, 5)">Level 1</button>
            <button onclick="startGame(2, 5)">Level 2</button>
            <button onclick="startGame(3, 5)">Level 3</button>
            <button onclick="startGame(4, 5)">Level 4</button>
            <button onclick="startGame(5, 5)">Level 5</button>
        </div>
    </div>
    
    <div id="game-container">
        <h1>漢字当てゲーム</h1>
        <div id="kanji-display"></div>
        <input type="text" id="input-box">
        <p id="message"></p>
        <p id="score">スコア: 0</p>
    </div>

    <script>
        const kanjiLists = [
            [ /* Level 1の問題 */
                { kanji: "体育", reading: "たいいく" },
                { kanji: "合口", reading: "あいくち" },
                { kanji: "運転", reading: "うんてん" },
                { kanji: "国家", reading: "こっか" },
                { kanji: "操縦", reading: "そうじゅう" }
            ],
            [ /* Level 2の問題 */
                { kanji: "抽象的", reading: "ちゅうしょうてき" },
                { kanji: "眼光", reading: "がんこう" },
                { kanji: "日本語", reading: "にほんご" },
                { kanji: "漢字", reading: "かんじ" },
                { kanji: "今回", reading: "こんかい" }
            ],
            [ /* Level 3の問題 */
                { kanji: "蝦蟇口", reading: "がまぐち" },
                { kanji: "運転免許証", reading: "うんてんめんきょしょう" },
                { kanji: "空覚え", reading: "うろおぼ" },
                { kanji: "峨峨", reading: "がが" },
                { kanji: "鑓", reading: "やり" }
            ],
            [ /* Level 4の問題 */
                { kanji: "明明", reading: "あかあか" },
                { kanji: "蜀魂", reading: "ほととぎす" },
                { kanji: "按摩", reading: "あんま" },
                { kanji: "些とも", reading: "ちっ" },
                { kanji: "剣道", reading: "けんどう" }
            ],
            [ /* Level 5の問題 */
                { kanji: "花火", reading: "はなび" },
                { kanji: "螳螂", reading: "かまきり" },
                { kanji: "競争", reading: "きょうそう" },
                { kanji: "図書館", reading: "としょかん" },
                { kanji: "薔薇", reading: "ばら" }
            ]
        ];

        // 問題をランダムに並び替える関数
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        const kanjiDisplay = document.getElementById("kanji-display");
        const inputBox = document.getElementById("input-box");
        const message = document.getElementById("message");
        const scoreDisplay = document.getElementById("score");
        const levelSelection = document.getElementById("level-selection");
        const startContainer = document.getElementById("start-container");
        const gameContainer = document.getElementById("game-container");

        let currentKanjiIndex = 0;
        let currentLevel = 1;
        let numQuestions = 5;

        // ゲームを開始する関数
        function startGame(level, questions) {
            currentLevel = level;
            numQuestions = questions;
            currentKanjiIndex = 0;
            shuffle(kanjiLists[currentLevel - 1]); // 問題をランダムに並び替え
            displayKanji();
            inputBox.value = "";
            inputBox.removeAttribute("disabled");
            inputBox.focus();
            message.textContent = "";
            score = 0;
            updateScore();
            startContainer.style.display = "none";
            gameContainer.style.display = "block";
            inputBox.addEventListener("input", checkInput);
            window.addEventListener("keyup", handleKeyUp);
        }

        // 問題を表示する関数
        function displayKanji() {
            if (currentKanjiIndex < kanjiLists[currentLevel - 1].length && currentKanjiIndex < numQuestions) {
                kanjiDisplay.textContent = kanjiLists[currentLevel - 1][currentKanjiIndex].kanji;
            } else {
                message.textContent = "ゲームクリア！ レベル" + currentLevel + "をクリアしました。";
                inputBox.setAttribute("disabled", "disabled");
            }
        }

        // 入力をチェックする関数
        function checkInput() {
            const typedReading = inputBox.value.trim();
            const correctReading = kanjiLists[currentLevel - 1][currentKanjiIndex].reading;
            if (typedReading === correctReading) {
                score++;
                currentKanjiIndex++;
                if (currentKanjiIndex < kanjiLists[currentLevel - 1].length && currentKanjiIndex < numQuestions) {
                    displayKanji();
                    inputBox.value = "";
                    message.textContent = "正解！次の漢字に進んでください。";
                } else {
                    message.textContent = "ゲームクリア！ レベル" + currentLevel + "をクリアしました。";
                    inputBox.setAttribute("disabled", "disabled");
                }
                updateScore();
            }
        }

        // スコアを更新する関数
        function updateScore() {
            scoreDisplay.textContent = "スコア: " + score;
        }

        // Escキーの処理を行う関数
        function handleKeyUp(event) {
            if (event.key === "Escape") {
                initialize();
            }
        }

        // ゲームを初期化する関数
        function initialize() {
            startContainer.style.display = "block";
            gameContainer.style.display = "none";
        }

        initialize();
    </script>
</body>
</html>
